<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Georgia Watch – Georgia Hospital System Scorecard</title>
  <link rel="stylesheet" href="styles.css" />
  <style>html{font-family:"Century Gothic","Avant Garde",Avenir,Helvetica,Arial,sans-serif}</style>
</head>
<body>
  <header class="site-header">
    <div class="wrap header-inner">
      <a class="brand" href="#">
        <span class="brand-mark">WATCH</span>
        <span class="brand-text">Georgia Watch</span>
      </a>
      <nav class="main-nav" aria-label="Primary">
        <a href="#">Georgia Watch</a>
        <a class="active" href="#">Rankings</a>
        <a href="#">Methodology</a>
        <a href="#">About Us</a>
      </nav>
      <div class="header-cta">
        <div class="donate-help">
          <span>Help us keep GWATCH running</span>
          <a class="btn btn-donate" href="#">Donate</a>
        </div>
        <a class="btn btn-download" href="#" id="downloadBtn">Download Results</a>
      </div>
    </div>
    <div class="wrap hero">
      <h1>GEORGIA WATCH<br><span class="h1-sub">Georgia Hospital System Scorecard</span></h1>
      <p class="tagline">Advocating for patients and protecting consumers since 2002</p>
    </div>
  </header>

  <div class="wrap page">
    <aside class="sidebar">
      <label class="field">
        <span>Enter hospital name</span>
        <input id="nameFilter" type="text" placeholder="Type to search…" />
      </label>

      <fieldset class="facet">
        <legend>Filters</legend>

        <label class="check">
          <input type="checkbox" id="fUrban">
          <span>Urban</span>
        </label>

        <label class="check">
          <input type="checkbox" id="fRural">
          <span>Rural</span>
        </label>

        <label class="check">
          <input type="checkbox" id="fCAH">
          <span>Critical Access</span>
        </label>

        <label class="check">
          <input type="checkbox" id="fNonprofit">
          <span>Nonprofit</span>
        </label>

        <label class="check">
          <input type="checkbox" id="fSystem">
          <span>In a System</span>
        </label>

        <button id="clearFilters" class="btn btn-clear">Clear filters</button>
      </fieldset>

      <div class="facet facet-cities">
        <div class="facet-head">
          <strong>Cities</strong>
          <button id="allCities" class="linklike">All cities</button>
        </div>
        <div id="cityList" class="city-list"></div>
      </div>
    </aside>

    <main class="content">
      <div class="results-bar">
        <span id="resultCount">Viewing 0 results</span>
        <div id="activePills" class="pills"></div>
      </div>
      <section id="results"></section>

      <section class="detail-panel hidden" id="detailPanel">
        <div class="panel-head">
          <div class="rank" id="d-rank">1</div>
          <div class="badge" id="d-grade">A</div>
          <div class="panel-titles">
            <h3 class="hosp-name" id="d-name">Hospital</h3>
            <p class="hosp-meta" id="d-addr">Address</p>
          </div>
          <button class="chev" id="toggleDetail" aria-expanded="true" aria-controls="detailBody">▾</button>
        </div>
        <div class="panel-body" id="detailBody">
          <div class="mini-map">Map placeholder</div>
          <ul class="facts" id="facts"></ul>
          <div class="cat-cards">
            <div class="cat">Financial Transparency &amp; Institutional Health</div>
            <div class="cat">Community Benefit Spending</div>
            <div class="cat">Healthcare Access &amp; Social Responsibility</div>
            <div class="cat">Healthcare Affordability &amp; Billing</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <footer class="site-footer">
    <div class="wrap">
      <nav class="footer-nav">
        <a href="#">Georgia Watch</a>
        <a href="#">Rankings</a>
        <a href="#">Methodology</a>
        <a href="#">About Us</a>
        <a href="#">Donate</a>
        <a href="#">Legal/Privacy</a>
        <a href="#">Site Map</a>
      </nav>
      <p class="copyright">
        Georgia Watch is a non-profit, nonpartisan 501(c)(3) organization. © 2024 Georgia Watch. All Rights Reserved.
      </p>
    </div>
  </footer>

  <script type="module">
    import { gradeLetter, uniqueCities } from './ui.js';

    const dataUrl = './data/2025_Lown_Index.json';
    const resEl = document.getElementById('results');
    const countEl = document.getElementById('resultCount');
    const pillsEl = document.getElementById('activePills');
    const cityList = document.getElementById('cityList');
    const allCitiesBtn = document.getElementById('allCities');

    const nameFilter = document.getElementById('nameFilter');
    const fUrban = document.getElementById('fUrban');
    const fRural = document.getElementById('fRural');
    const fCAH = document.getElementById('fCAH');
    const fNonprofit = document.getElementById('fNonprofit');
    const fSystem = document.getElementById('fSystem');
    const clearFilters = document.getElementById('clearFilters');

    const downloadBtn = document.getElementById('downloadBtn');
    const detailPanel = document.getElementById('detailPanel');
    const dRank = document.getElementById('d-rank');
    const dGrade = document.getElementById('d-grade');
    const dName = document.getElementById('d-name');
    const dAddr = document.getElementById('d-addr');
    const facts = document.getElementById('facts');
    const toggleDetail = document.getElementById('toggleDetail');
    const detailBody = document.getElementById('detailBody');

    let raw = [];
    let view = [];
    let selectedCity = null;

    const data = await fetch(dataUrl).then(r => r.json());
    raw = Array.isArray(data) ? data : (data.items || []);

    const cities = uniqueCities(raw);
    cityList.innerHTML = cities.map(c => /
